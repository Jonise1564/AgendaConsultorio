extends ../layout

block contenido
  .container.mt-5
    h2 Crear Nueva Agenda
    form(action="/agendas" method="POST")
      h3 Fechas
      .mb-3  
        label(for="fecha_creacion" class="form-label") Comienza:
        input#fecha_creacion.form-control(type="date" name="fecha_creacion" required)
      .mb-3  
        label(for="fecha_fin" class="form-label") Finaliza:
        input#fecha_fin.form-control(type="date" name="fecha_fin" required)
      h3 Horas
      .mb-3
        label(for="hora_inicio" class="form-label") Inicio:
        input#hora_inicio.form-control(type="time" name="hora_inicio" required)
      .mb-3
        label(for="hora_fin" class="form-label") Final:
        input#hora_fin.form-control(type="time" name="hora_fin" required)
      .mb-3
        label(for="duracion_turnos" class="form-label") Duración de Turnos:
        input#duracion_turnos.form-control(type="number" name="duracion_turnos" required)
      .mb-3
        label(for="limite_sobreturnos" class="form-label") Limite de Sobreturnos:
        input#limite_sobreturnos.form-control(type="number" name="limite_sobreturnos" required)

      h3 Médico y Especialidades
      .mb-3
        label(for="medicosSelect" class="form-label") Selecciona un Médico:
        select#medicosSelect.form-control(name="medicoId" required)
          option(value="") Selecciona un médico
          each medico in medicos
            option(value=medico.id) #{medico.nombre} #{medico.apellido}
      .mb-3
        label(for="especialidadesSelect" class="form-label") Selecciona una Especialidad:
        select#especialidadesSelect.form-control(name="especialidadId" style="display:none")
          option(value="") Selecciona una especialidad

      button(type="submit" class="btn btn-primary") Crear Agenda

    script(src="https://code.jquery.com/jquery-3.6.0.min.js")
    script.
      $('#medicosSelect').on('change', function() {
        const medicoId = $(this).val();
        if (medicoId) {
          $.ajax({
            url: `/especialidades/${medicoId}`,
            method: 'GET',
            success: function(data) {
              const especialidadesSelect = $('#especialidadesSelect');
              especialidadesSelect.empty().append('<option value="">Selecciona una especialidad</option>');
              data.forEach(especialidad => {
                especialidadesSelect.append(`<option value="${especialidad.id}">${especialidad.nombre}</option>`);
              });
              especialidadesSelect.show();
            },
            error: function(error) {
              console.error('Error:', error);
            }
          });
        } else {
          $('#especialidadesSelect').hide();
        }
      });

    script(src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous")
    script(src="/js/agendas.js")
